<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>C.O.S.M.I.C HUD</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>

<div id="hud">
  <div id="avatarHud">
    <div id="levelHud"></div>
  </div>

  <div id="hudInfo">
    <div id="name"></div>

    <div id="vidaText"></div>
    <div class="bar-container" id="vidaBar">
      <div class="bar vida" id="vidaFill"></div>
    </div>

    <div id="manaText"></div>
    <div id="diceContainer"></div>
  </div>
</div>

<!-- SOCKET -->
<script src="/socket.io/socket.io.js"></script>
<script>
  const socket = io();

  // ID do HUD (TEM que bater com o controller)
  const hudId = "leafone";
  socket.emit("join", hudId);

  const vidaFill = document.getElementById("vidaFill");
  const vidaBar = document.getElementById("vidaBar");
  const vidaText = document.getElementById("vidaText");
  const manaText = document.getElementById("manaText");
  const diceContainer = document.getElementById("diceContainer");

  socket.on("hudUpdate", s => {
    document.getElementById("name").innerText = s.name ?? "";
    document.getElementById("levelHud").innerText = s.level ?? "";

    if (s.vidaAtual != null) {
      vidaText.innerText = `${s.vidaAtual}/${s.vidaMax}`;
      vidaFill.style.width = `${(s.vidaAtual / s.vidaMax) * 100}%`;
      vidaBar.style.display = s.showVidaBar ? "block" : "none";
    }

    if (s.manaAtual != null) {
      manaText.innerText = `${s.manaAtual}/${s.manaMax}`;
    }

    if (s.dice?.rolls) {
      diceContainer.innerHTML = "";
      s.dice.rolls.forEach(v => {
        const d = document.createElement("div");
        d.className = "diceHex";
        d.textContent = v;
        diceContainer.appendChild(d);
      });
    }
  });
</script>

</body>
</html>
